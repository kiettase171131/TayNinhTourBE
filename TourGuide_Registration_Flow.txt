ğŸ¯ TOURGUIDE REGISTRATION FLOW DOCUMENTATION
===========================================

ğŸ“ OVERVIEW
===========
Enhanced TourGuide registration system tÆ°Æ¡ng tá»± SpecialtyShop flow.
NÃ¢ng cáº¥p tá»« TourGuideApplication hiá»‡n táº¡i Ä‘á»ƒ cÃ³ Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng professional.

ğŸ—ï¸ SYSTEM ARCHITECTURE
======================

Current TourGuideApplication (Basic):
------------------------------------
- UserId, Email, CurriculumVitae, Status, RejectionReason
- Chá»‰ 5 fields cÆ¡ báº£n, thiáº¿u nhiá»u thÃ´ng tin quan trá»ng

Enhanced TourGuideApplication (Target):
--------------------------------------
- Personal Info: FullName, PhoneNumber, Email
- Professional Info: Experience, Languages (optional)
- Documents: CurriculumVitae (required)
- Tracking: Status, RejectionReason, SubmittedAt, ProcessedAt, ProcessedById
- BaseEntity fields: Id, CreatedAt, UpdatedAt, IsDeleted, IsActive

ğŸ“Š DATABASE SCHEMA
==================

Enhanced TourGuideApplication Entity:
------------------------------------
- Id (Guid, PK)
- UserId (Guid, FK to User, required)
- FullName (string, 100 chars, required)
- PhoneNumber (string, 20 chars, required)
- Email (string, 100 chars, required, email format)
- Experience (int, years, required) - sá»‘ nÄƒm kinh nghiá»‡m
- Languages (string, 200 chars, optional) - ngÃ´n ngá»¯ biáº¿t (VN, EN, CN...)
- CurriculumVitae (string, 500 chars) - URL to CV file
- Status (TourGuideApplicationStatus, required, default Pending)
- RejectionReason (string, 500 chars, nullable)
- SubmittedAt (DateTime, required)
- ProcessedAt (DateTime, nullable)
- ProcessedById (Guid, nullable, FK to User)
- CreatedAt, UpdatedAt, IsDeleted, IsActive (BaseEntity fields)

TourGuideApplicationStatus Enum:
-------------------------------
- Pending = 0 (Chá» xá»­ lÃ½)
- Approved = 1 (ÄÃ£ duyá»‡t)
- Rejected = 2 (Tá»« chá»‘i)

Role Updates:
-------------
Sá»­ dá»¥ng role "TourGuide" Ä‘Ã£ cÃ³ trong Constants.RoleTourGuideName

ğŸŒ API ENDPOINTS
================

User Endpoints (Role: "User"):
------------------------------
POST /api/Account/tourguide-application
- Authorization: Bearer token, Role "User"
- Body: SubmitTourGuideApplicationDto (multipart/form-data)
- Function: User ná»™p Ä‘Æ¡n Ä‘Äƒng kÃ½ TourGuide vá»›i documents
- Response: TourGuideApplicationSubmitResponseDto

GET /api/Account/my-tourguide-applications
- Authorization: Bearer token, Role "User"
- Function: Xem danh sÃ¡ch Ä‘Æ¡n Ä‘Äƒng kÃ½ cá»§a user
- Response: List<TourGuideApplicationSummaryDto>

GET /api/Account/tourguide-application/{id}
- Authorization: Bearer token, Role "User"
- Function: Xem chi tiáº¿t Ä‘Æ¡n Ä‘Äƒng kÃ½ cá»§a user
- Response: TourGuideApplicationDto

Admin/CMS Endpoints (Role: "Admin"):
-----------------------------------
GET /api/Cms/tourguide-applications
- Authorization: Bearer token, Role "Admin"
- Query: status, page, pageSize, fromDate, toDate
- Function: Admin xem danh sÃ¡ch táº¥t cáº£ Ä‘Æ¡n Ä‘Äƒng kÃ½
- Response: PagedResult<TourGuideApplicationSummaryDto>

GET /api/Cms/tourguide-applications/{id}
- Authorization: Bearer token, Role "Admin"
- Function: Admin xem chi tiáº¿t Ä‘Æ¡n Ä‘Äƒng kÃ½
- Response: TourGuideApplicationDto

PUT /api/Cms/tourguide-applications/{id}/approve
- Authorization: Bearer token, Role "Admin"
- Function: Duyá»‡t Ä‘Æ¡n Ä‘Äƒng kÃ½, tá»± Ä‘á»™ng cáº¥p role "TourGuide"
- Response: Success message

PUT /api/Cms/tourguide-applications/{id}/reject
- Authorization: Bearer token, Role "Admin"
- Body: RejectTourGuideApplicationDto (reason)
- Function: Tá»« chá»‘i Ä‘Æ¡n Ä‘Äƒng kÃ½ vá»›i lÃ½ do
- Response: Success message

ğŸ“ DTOs DESIGN
==============

SubmitTourGuideApplicationDto:
-----------------------------
- FullName (string, required)
- PhoneNumber (string, required)
- Email (string, required, email format)
- Experience (int, required, min 0)
- Languages (string, optional)
- CurriculumVitae (IFormFile, required) - PDF file

TourGuideApplicationDto:
-----------------------
- Id (Guid)
- FullName (string)
- PhoneNumber (string)
- Email (string)
- Experience (int)
- Languages (string)
- CurriculumVitaeUrl (string)
- Status (TourGuideApplicationStatus)
- RejectionReason (string)
- SubmittedAt (DateTime)
- ProcessedAt (DateTime?)
- UserInfo (UserSummaryDto)
- ProcessedByInfo (UserSummaryDto?)

TourGuideApplicationSummaryDto:
------------------------------
- Id (Guid)
- FullName (string)
- PhoneNumber (string)
- Experience (int)
- Status (TourGuideApplicationStatus)
- SubmittedAt (DateTime)
- UserName (string)
- UserEmail (string)

TourGuideApplicationSubmitResponseDto:
-------------------------------------
- StatusCode (int)
- Message (string)
- ApplicationId (Guid)
- FullName (string)
- CurriculumVitaeUrl (string)
- SubmittedAt (DateTime)

RejectTourGuideApplicationDto:
-----------------------------
- Reason (string, required)

âš™ï¸ BUSINESS LOGIC FLOW
======================

1. SUBMIT APPLICATION (User):
-----------------------------
a. Validate user role = "User"
b. Validate input data (required fields, email format, age >= 18, etc.)
c. Check duplicate: user chÆ°a cÃ³ Ä‘Æ¡n pending hoáº·c approved
d. Upload documents to file storage:
   - CV (PDF, max 5MB)
   - ID Card (Image, max 2MB)
   - Tour Guide License (PDF/Image, max 3MB, optional)
   - Certificates (Multiple files, max 2MB each, optional)
e. Create TourGuideApplication entity vá»›i status = Pending
f. Send confirmation email to user
g. Send notification email to admin
h. Return success response vá»›i file URLs

2. ADMIN REVIEW (Admin):
-----------------------
a. Admin xem danh sÃ¡ch Ä‘Æ¡n pending
b. Admin xem chi tiáº¿t Ä‘Æ¡n + download documents
c. Admin quyáº¿t Ä‘á»‹nh approve/reject

3. APPROVE APPLICATION (Admin):
------------------------------
a. Validate application status = Pending
b. Get "TourGuide" role (táº¡o náº¿u chÆ°a cÃ³)
c. Update user role = "TourGuide"
d. Update application: status = Approved, ProcessedAt, ProcessedById
e. Send approval email to user
f. Return success response

4. REJECT APPLICATION (Admin):
-----------------------------
a. Validate application status = Pending
b. Update application: status = Rejected, RejectionReason, ProcessedAt, ProcessedById
c. Send rejection email to user vá»›i lÃ½ do
d. Return success response

ğŸ”’ VALIDATION RULES
===================

Submit Application:
------------------
- User role = "User" (khÃ´ng pháº£i Admin, TourGuide, etc.)
- User chÆ°a cÃ³ Ä‘Æ¡n Pending hoáº·c Approved
- FullName: required, 2-100 chars
- PhoneNumber: required, valid phone format
- Email: required, valid email format
- Experience: required, >= 0 years
- Languages: optional, max 200 chars
- CV file: required, PDF, max 5MB

File Upload:
-----------
- CV: .pdf only, max 5MB

ğŸ“§ EMAIL NOTIFICATIONS
======================

1. Application Submitted (to User):
----------------------------------
Subject: "ÄÆ¡n Ä‘Äƒng kÃ½ hÆ°á»›ng dáº«n viÃªn du lá»‹ch Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng"
Content: XÃ¡c nháº­n Ä‘Æ¡n Ä‘Ã£ nháº­n, thá»i gian xá»­ lÃ½ dá»± kiáº¿n, thÃ´ng tin liÃªn há»‡

2. Application Submitted (to Admin):
-----------------------------------
Subject: "ÄÆ¡n Ä‘Äƒng kÃ½ hÆ°á»›ng dáº«n viÃªn má»›i cáº§n xá»­ lÃ½"
Content: ThÃ´ng tin cÆ¡ báº£n cá»§a Ä‘Æ¡n, link xem chi tiáº¿t

3. Application Approved (to User):
---------------------------------
Subject: "ChÃºc má»«ng! ÄÆ¡n Ä‘Äƒng kÃ½ hÆ°á»›ng dáº«n viÃªn Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t"
Content: ThÃ´ng bÃ¡o duyá»‡t, hÆ°á»›ng dáº«n sá»­ dá»¥ng tÃ i khoáº£n TourGuide

4. Application Rejected (to User):
---------------------------------
Subject: "ÄÆ¡n Ä‘Äƒng kÃ½ hÆ°á»›ng dáº«n viÃªn khÃ´ng Ä‘Æ°á»£c duyá»‡t"
Content: LÃ½ do tá»« chá»‘i, hÆ°á»›ng dáº«n ná»™p Ä‘Æ¡n má»›i

ğŸ—‚ï¸ FILE STRUCTURE
=================

Required Files for Enhanced TourGuide Registration:
--------------------------------------------------
1. Entities/TourGuideApplication.cs (Enhanced)
2. Enums/TourGuideApplicationStatus.cs (New)
3. DTOs/Request/SubmitTourGuideApplicationDto.cs (Enhanced)
4. DTOs/Response/TourGuideApplicationDto.cs (New)
5. DTOs/Response/TourGuideApplicationSummaryDto.cs (New)
6. DTOs/Response/TourGuideApplicationSubmitResponseDto.cs (New)
7. DTOs/Request/RejectTourGuideApplicationDto.cs (New)
8. Services/Interface/ITourGuideApplicationService.cs (Enhanced)
9. Services/TourGuideApplicationService.cs (Enhanced)
10. Controllers/AccountController.cs (Update endpoints)
11. Controllers/CmsController.cs (Add TourGuide endpoints)
12. Repositories/Interface/ITourGuideApplicationRepository.cs (Enhanced)
13. Repositories/TourGuideApplicationRepository.cs (Enhanced)
14. EntityConfigurations/TourGuideApplicationConfiguration.cs (Enhanced)
15. Migrations/EnhanceTourGuideApplicationTable.cs (New)
16. EmailTemplates for TourGuide notifications

ğŸ”„ MIGRATION STRATEGY
====================

Phase 1: Backup & Schema Update
------------------------------
1. Backup existing TourGuideApplication data
2. Create migration to add new columns
3. Set default values for existing records
4. Test migration in development

Phase 2: Code Enhancement
------------------------
1. Update Entity with new fields
2. Create enhanced DTOs
3. Update Service methods
4. Update Controller endpoints
5. Add email templates

Phase 3: Data Migration
----------------------
1. Migrate existing data to new format
2. Update existing applications with default values
3. Test all endpoints
4. Deploy to production

ğŸ¯ SUCCESS CRITERIA
==================
- âœ… Enhanced TourGuideApplication vá»›i Ä‘áº§y Ä‘á»§ fields
- âœ… File upload handling cho multiple documents
- âœ… Email notifications hoÃ n chá»‰nh
- âœ… Admin CMS endpoints Ä‘áº§y Ä‘á»§
- âœ… Validation rules comprehensive
- âœ… Migration existing data thÃ nh cÃ´ng
- âœ… API testing 100% pass
- âœ… Documentation Ä‘áº§y Ä‘á»§

ğŸ“‹ IMPLEMENTATION CHECKLIST
===========================
â–¡ Create TourGuideApplicationStatus enum
â–¡ Enhance TourGuideApplication entity
â–¡ Create enhanced DTOs (Submit, Response, Summary)
â–¡ Update ITourGuideApplicationService interface
â–¡ Enhance TourGuideApplicationService implementation
â–¡ Update ITourGuideApplicationRepository interface
â–¡ Enhance TourGuideApplicationRepository implementation
â–¡ Update AccountController endpoints
â–¡ Add CmsController TourGuide endpoints
â–¡ Create EntityConfiguration
â–¡ Create database migration
â–¡ Add email templates
â–¡ Update Program.cs DI registrations
â–¡ Create API documentation
â–¡ Write unit tests
â–¡ Perform integration testing
â–¡ Data migration script
â–¡ Production deployment
