# PHÃ‚N TÃCH FLOW VÃ€ API REQUIREMENTS CHO TOUR TEMPLATE SYSTEM

## ğŸ“‹ PHÃ‚N TÃCH REQUIREMENT VÃ€ Táº O FLOW

### ğŸ¯ Core Requirements:
1. **TourTemplate System**: Táº¡o template Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng
2. **Scheduling**: Chá»‰ T7 hoáº·c CN, 4 láº§n/thÃ¡ng, tá»± Ä‘á»™ng theo thÃ¡ng/nÄƒm
3. **Tour Types**: 2 loáº¡i (Free Scenic vs Paid Attraction)
4. **Timeline Management**: ThÃªm/sá»­a má»‘c thá»i gian linh hoáº¡t
5. **Shop Integration**: Chá»n shop tá»± Ä‘á»™ng Ä‘iá»n vÃ o lá»‹ch trÃ¬nh
6. **Image Management**: ThÃªm hÃ¬nh áº£nh vÃ o template

---

## ğŸ”„ CÃC FLOW CHÃNH

### FLOW 1: Táº¡o Tour Template
```
[TourCompany Login]
    â†“
[Chá»n "Táº¡o Template Má»›i"]
    â†“
[Äiá»n thÃ´ng tin cÆ¡ báº£n]
- Title, Description
- Tour Type (FreeScenic/PaidAttraction)
- Start/End Location
- Duration, Max/Min Guests
    â†“
[Upload Images]
    â†“
[LÆ°u Template]
    â†“
[Template Ä‘Æ°á»£c táº¡o vá»›i ID]
```

**APIs cáº§n thiáº¿t:**
- âœ… POST /api/TourCompany/template - Create template
- âœ… POST /api/Image/upload - Upload images (cÃ³ sáºµn)

### FLOW 2: Quáº£n lÃ½ Timeline cho Template
```
[Chá»n Template Ä‘Ã£ táº¡o]
    â†“
[VÃ o Timeline Editor]
    â†“
[ThÃªm má»‘c thá»i gian]
- TimeSlot (10:00, 11:00...)
- Location/Activity
- Description HOáº¶C chá»n Shop
    â†“
[Náº¿u chá»n Shop]
    â†“
[Hiá»ƒn thá»‹ dropdown shops]
    â†“
[Auto-fill "GhÃ© + TÃªn Shop"]
    â†“
[Sáº¯p xáº¿p láº¡i thá»© tá»± timeline]
    â†“
[LÆ°u timeline]
```

**APIs cáº§n thiáº¿t:**
- âœ… GET /api/TourDetails/timeline/{templateId} - Get timeline
- âœ… POST /api/TourDetails/timeline - Add timeline item
- âœ… PATCH /api/TourDetails/timeline/{id} - Update timeline item
- âœ… DELETE /api/TourDetails/timeline/{id} - Delete timeline item
- âœ… POST /api/TourDetails/timeline/reorder - Reorder timeline
- âœ… GET /api/TourDetails/shops - Get shops dropdown

### FLOW 3: Táº¡o Tour Slots (Scheduling)
```
[Chá»n Template]
    â†“
[Chá»n thÃ¡ng/nÄƒm]
    â†“
[Chá»n ngÃ y (T7 HOáº¶C CN)]
    â†“
[Há»‡ thá»‘ng tá»± Ä‘á»™ng tÃ­nh 4 slots trong thÃ¡ng]
    â†“
[Preview slots sáº½ Ä‘Æ°á»£c táº¡o]
    â†“
[XÃ¡c nháº­n táº¡o slots]
    â†“
[4 TourSlots Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng]
```

**APIs cáº§n thiáº¿t:**
- âœ… POST /api/TourSlot/preview - Preview slots
- âœ… POST /api/TourSlot/generate - Generate 4 slots
- âœ… GET /api/Scheduling/weekend-dates/{year}/{month} - Get weekend dates
- âœ… POST /api/Scheduling/generate-slot-dates - Generate optimal dates

### FLOW 4: Quáº£n lÃ½ Tour Operations
```
[Chá»n TourSlot Ä‘Ã£ táº¡o]
    â†“
[ThÃªm thÃ´ng tin váº­n hÃ nh]
- Chá»n hÆ°á»›ng dáº«n viÃªn
- Äáº·t giÃ¡ tour
- Sá»‘ gháº¿ tá»‘i Ä‘a
- Description bá»• sung
    â†“
[LÆ°u TourOperation]
    â†“
[Tour sáºµn sÃ ng cho khÃ¡ch Ä‘áº·t]
```

**APIs cáº§n thiáº¿t:**
- âŒ POST /api/TourOperation - **THIáº¾U API**
- âŒ GET /api/TourOperation/slot/{slotId} - **THIáº¾U API**
- âŒ PATCH /api/TourOperation/{id} - **THIáº¾U API**
- âŒ GET /api/User/guides - **THIáº¾U API** (Get danh sÃ¡ch hÆ°á»›ng dáº«n viÃªn)

### FLOW 5: Copy vÃ  TÃ¡i sá»­ dá»¥ng Template
```
[VÃ o danh sÃ¡ch Templates]
    â†“
[Chá»n template muá»‘n copy]
    â†“
[Báº¥m "Copy Template"]
    â†“
[Äiá»n tÃªn má»›i cho template]
    â†“
[Template má»›i Ä‘Æ°á»£c táº¡o vá»›i timeline giá»‘ng há»‡t]
    â†“
[CÃ³ thá»ƒ edit timeline cá»§a template má»›i]
```

**APIs cáº§n thiáº¿t:**
- âœ… GET /api/TourCompany/template - List templates
- âœ… POST /api/TourCompany/template/{id}/copy - Copy template
- âœ… PATCH /api/TourCompany/template/{id} - Edit copied template

### FLOW 6: Quáº£n lÃ½ Shop cho Timeline
```
[Admin/TourCompany táº¡o shops]
    â†“
[Shops hiá»ƒn thá»‹ trong dropdown khi táº¡o timeline]
    â†“
[Chá»n shop tá»± Ä‘á»™ng Ä‘iá»n "GhÃ© + TÃªn Shop"]
    â†“
[Shop info Ä‘Æ°á»£c lÆ°u trong timeline item]
```

**APIs cáº§n thiáº¿t:**
- âœ… GET /api/Shop - List shops
- âœ… POST /api/Shop - Create shop
- âœ… PATCH /api/Shop/{id} - Update shop
- âœ… GET /api/Shop/active - Get active shops

---

## âŒ CÃC API THIáº¾U CHO FLOW HOÃ€N CHá»ˆNH

### 1. TourOperation Management APIs:
```
POST /api/TourOperation
GET /api/TourOperation/slot/{slotId}
PATCH /api/TourOperation/{id}
DELETE /api/TourOperation/{id}
```

### 2. User/Guide Management APIs:
```
GET /api/User/guides - Láº¥y danh sÃ¡ch hÆ°á»›ng dáº«n viÃªn
GET /api/User/tourcompany-users - Láº¥y users thuá»™c tour company
```

### 3. Template vá»›i Slot Integration:
```
GET /api/TourSlot/template/{templateId} - Láº¥y slots theo template
```

### 4. Booking/Customer APIs (cho tÆ°Æ¡ng lai):
```
POST /api/Booking/slot/{slotId} - Äáº·t tour
GET /api/Booking/customer/{customerId} - Lá»‹ch sá»­ Ä‘áº·t tour
```

---

## âœ… ÄÃNH GIÃ Tá»”NG QUAN

### ÄÃ£ cÃ³ Ä‘áº§y Ä‘á»§ (85%):
- âœ… Template CRUD hoÃ n chá»‰nh
- âœ… Timeline management hoÃ n chá»‰nh
- âœ… Shop integration hoÃ n chá»‰nh
- âœ… Slot generation hoÃ n chá»‰nh
- âœ… Scheduling algorithm hoÃ n chá»‰nh
- âœ… Template copy functionality

### CÃ²n thiáº¿u (15%):
- âŒ TourOperation CRUD APIs
- âŒ Guide/User selection APIs
- âŒ Slot-Operation integration

### Káº¿t luáº­n:
Project Ä‘Ã£ thá»±c hiá»‡n **85% cÃ¡c API cáº§n thiáº¿t** cho flow hoÃ n chá»‰nh.
Chá»‰ cÃ²n thiáº¿u TourOperation management vÃ  User/Guide selection Ä‘á»ƒ hoÃ n thÃ nh 100% requirement.

---

## ğŸ“Š Tá»”NG Há»¢P API ÄÃƒ CÃ“ (35+ endpoints)

### TourCompanyController (/api/TourCompany):
- GET /api/TourCompany/template - List templates
- GET /api/TourCompany/template/{id} - Get template details
- POST /api/TourCompany/template - Create template
- PATCH /api/TourCompany/template/{id} - Update template
- DELETE /api/TourCompany/template/{id} - Delete template
- POST /api/TourCompany/template/{id}/copy - Copy template

### TourSlotController (/api/TourSlot):
- POST /api/TourSlot/generate - Generate slots
- POST /api/TourSlot/preview - Preview slots
- GET /api/TourSlot - Get slots vá»›i filtering
- GET /api/TourSlot/{id} - Get slot details
- PUT /api/TourSlot/{id} - Update slot
- DELETE /api/TourSlot/{id} - Delete slot
- POST /api/TourSlot/check-conflicts - Check conflicts
- PUT /api/TourSlot/bulk-status - Bulk update status

### TourDetailsController (/api/TourDetails):
- GET /api/TourDetails/timeline/{templateId} - Get timeline
- POST /api/TourDetails/timeline - Add timeline item
- PATCH /api/TourDetails/timeline/{id} - Update timeline item
- DELETE /api/TourDetails/timeline/{id} - Delete timeline item
- POST /api/TourDetails/timeline/reorder - Reorder timeline
- GET /api/TourDetails/shops - Get shops dropdown

### ShopController (/api/Shop):
- GET /api/Shop - List shops
- GET /api/Shop/{id} - Get shop details
- POST /api/Shop - Create shop
- PATCH /api/Shop/{id} - Update shop
- DELETE /api/Shop/{id} - Delete shop
- GET /api/Shop/active - Get active shops dropdown

### SchedulingController (/api/Scheduling):
- GET /api/Scheduling/weekend-dates/{year}/{month} - Get weekend dates
- POST /api/Scheduling/generate-slot-dates - Generate slot dates
- POST /api/Scheduling/validate - Validate schedule input
- POST /api/Scheduling/next-available-slots - Get available slots
- POST /api/Scheduling/optimal-distribution - Calculate distribution
- GET /api/Scheduling/run-tests - Run unit tests
- GET /api/Scheduling/run-test/{testName} - Run specific test

### TourMigrationController (/api/TourMigration):
- GET /api/TourMigration/preview - Preview migration
- POST /api/TourMigration/execute - Execute migration
- POST /api/TourMigration/rollback - Rollback migration
- GET /api/TourMigration/status - Get migration status

### HealthController (/api/Health):
- GET /api/Health/ping - Simple health check
- GET /api/Health/database - Database health check
- GET /api/Health/status - Full system status

---

**NgÃ y táº¡o**: 06/06/2025
**TÃ¡c giáº£**: PhÃ¢n tÃ­ch dá»±a trÃªn requirement vÃ  codebase hiá»‡n táº¡i
**Tráº¡ng thÃ¡i**: 85% hoÃ n thÃ nh, cáº§n bá»• sung TourOperation APIs